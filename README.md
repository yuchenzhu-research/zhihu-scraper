<div align="center">

# ğŸ•·ï¸ Zhihu Scraper

**é«˜ä¿çœŸçŸ¥ä¹å†…å®¹ç¦»çº¿å¤‡ä»½å·¥å…· Â· çº¯åç«¯åŸç”Ÿ API æ¡æ‰‹ Â· SQLite å®ä½“åº“æ¶æ„**

[![Python Version](https://img.shields.io/pypi/pyversions/zhihu-scraper.svg?style=for-the-badge&logo=python)](https://pypi.org/project/zhihu-scraper/)
[![License](https://img.shields.io/github/license/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)
[![Stars](https://img.shields.io/github/stars/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge&logo=github)](https://github.com/yuchenzhu-research/zhihu-scraper/stargazers)
[![Issues](https://img.shields.io/github/issues/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge)](https://github.com/yuchenzhu-research/zhihu-scraper/issues)

**[æé€ŸæŠ“å–]** Â· **[é˜²å°å· Cookie æ± ]** Â· **[Markdown ä¸æ•°æ®åº“åŒå¼•æ“å­˜å‚¨]**

</div>

---

## âš¡ æ ¸å¿ƒæ¼”è¿› (Core Evolution)

æœ¬é¡¹ç›®é‡æ„ä¸ºç›´æ¥ä¸çŸ¥ä¹åå° JSON API äº¤äº’çš„çº¯ç²¹ç½‘ç»œåè®®å¼•æ“ã€‚é¡¹ç›®ä¸¥æ ¼éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) çš„åˆ†å±‚æ€æƒ³ï¼Œæœç»äº†é¢æ¡ä»£ç ã€‚

| æ ¸å¿ƒç»„ä»¶å¼•æ“ | æŠ€æœ¯è§£æä¸åŠŸèƒ½ç‰¹æ€§ |
| :--- | :--- |
| ğŸš€ **åŸç”Ÿ API æé€Ÿå¼•æ“** | ä¾èµ– `curl_cffi` å®Œç¾æ¨¡æ‹Ÿ Chrome åº•å±‚ TLS/HTTP2 ç½‘ç»œæ¡æ‰‹æŒ‡çº¹ï¼Œæ— è§†ç»å¤§æ•°ç½‘å…³æ‹¦æˆªã€‚åŒæ—¶æœ¬åœ°å†…ç½® `z_core.js` V8 é€†å‘ç­¾åéªŒè¯ï¼Œå®ç° **æ¯«ç§’çº§ã€0æ¸²æŸ“å¼€é”€** çš„æ•°æ®æ•è·ã€‚ |
| ğŸ’¿ **SQLite ä¸»åŠ¨å­˜å‚¨æ± ** | è·å–åˆ°çš„æ¯ä¸€ä¸ªé—®é¢˜/ä¸“æ /å›ç­”ï¼Œæå–å‡ºæ ¸å¿ƒå­—æ®µï¼Œä½¿ç”¨ UPSERTï¼ˆå†²çªå¹³æ»‘æ›´æ–°ï¼‰æŒä¹…åŒ–å†™å…¥ `data/zhihu.db` æ„å»ºçœŸæ­£çš„**æœ¬åœ°åŒ–æ™ºèƒ½çŸ¥è¯†åº“**ã€‚ |
| ğŸ”„ **è‡ªåŠ¨åŒ–å¢é‡ç›‘å¬ (Monitor)** | å…¨æ–°æŒ‡ä»¤ `zhihu monitor`ï¼åˆ©ç”¨çŠ¶æ€æŒ‡é’ˆ (Last ID) å®ç°å¯¹ä¸Šä¸‡æ¡çŸ¥ä¹â€œæ”¶è—å¤¹â€è®°å½•çš„**æ— ç¼å¢é‡æ‰«æ**ï¼ŒåªæŠ“å–æœ€æ–°åŠ å…¥çš„æ•°æ®ã€‚æå…¶é€‚åˆæŒ‚è½½ Cron å®šæ—¶ä»»åŠ¡ï¼ |
| ğŸ›¡ï¸ **ä¸“æ å¢™é™çº§ä¸ Cookie æ± ** | å†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼šå½“é¢å¯¹é˜²æŠ“å–æä¸¥è°¨çš„**çŸ¥ä¹ä¸“æ **æ—¶ï¼Œè‡ªåŠ¨æ— æ„Ÿæ‹‰èµ· Playwright å¹¶æ³¨å…¥åŠ¨æ€ **Cookie è½®æ¢æ± **ä¸­çš„å¤‡ç”¨è´¦å·ï¼Œçªç ´ç»ˆæ `zse_ck` é˜²çº¿ï¼ |
| ğŸ“ **æ’ç‰ˆå¼•æ“å¢å¼º** | å®Œå–„å¹¶æ¸…æ´—å›¾ç‰‡é˜²ç›—é“¾é“¾æ¥ï¼Œåœ¨æœ€ç»ˆå¯¼å‡ºçš„çº¯å‡€ `Markdown` å†…å®Œç¾ç¦»çº¿è½¬æ¢å¤æ‚çš„ LaTeX ($...$) çŸ©é˜µå…¬å¼ä¸é‡ç‚¹åŠ ç²—å†…å®¹ã€‚ |

---

## ğŸ—ï¸ æ¶æ„ç²’åº¦æ‹†è§£ (Directory Structure)

å½“å‰çš„æ¶æ„éå¸¸æ¸…æ™°ï¼Œå®ç°äº†æ¨¡å—åŒ–ã€è§£è€¦åˆä¸é«˜å†…èšï¼š

*   **`cli/` (å…¥å£ä¸è§†å›¾å±‚)**
    *   `app.py`: æ ¸å¿ƒ Typer CLI è·¯ç”±ã€‚å®šä¹‰äº† `fetch`, `batch`, `monitor`, `query` ç­‰æ ¸å¿ƒå‘½ä»¤ï¼Œè´Ÿè´£è§£æç”¨æˆ·ä¼ å‚å¹¶ä¸‹å‘ç»™ core å±‚ï¼Œæœ€åæ•´åˆ UI è¾“å‡ºã€‚
    *   `interactive.py`: æå…·è®¾è®¡æ„Ÿçš„äº¤äº’å¼ä»ªè¡¨ç›˜ç»ˆç«¯ï¼ˆé€šè¿‡ `zhihu interactive` è§¦å‘ï¼‰ï¼Œæ˜¯å¯¹ä¼ ç»Ÿå‘½ä»¤è¡Œè¾“å…¥çš„å›¾å½¢åŒ–å¢å¼ºã€‚
*   **`core/` (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚)**
    *   **`api_client.py`**: å¼•æ“ä¹‹æºã€‚å›Šæ‹¬äº†å‘çŸ¥ä¹å‘èµ· API è¯·æ±‚çš„åº•å±‚é€šé“ã€‚è´Ÿè´£åˆå¹¶ Cookieã€ç”Ÿæˆæ—¶é—´æˆ³ã€è°ƒç”¨ `z_core.js` ç®—ç­¾åã€é™„å¸¦ TLS æŒ‡çº¹ï¼Œæœ€åè¿”å›çº¯å‡€çš„ Dict æ•°æ®ã€‚
    *   **`scraper.py`**: é¡µé¢çº§ä¸šåŠ¡ç¼–æ’ã€‚åˆ¤æ–­ URL ç±»å‹ï¼ˆé—®é¢˜/å›ç­”/ä¸“æ ï¼‰ï¼Œå‘ `api_client` ç´¢è¦æ•°æ®ï¼Œæç‚¼æ ‡é¢˜ä¸æ­£æ–‡ HTMLï¼Œå¹¶ç»Ÿç­¹å›¾ç‰‡ä¸‹è½½å·¥ä½œã€‚
    *   **`converter.py`**: Markdown è§£æå™¨ã€‚æ¥æ”¶ HTMLï¼Œå°†å›¾ç‰‡æ›¿æ¢ä¸ºæœ¬åœ°ç›¸å¯¹è·¯å¾„ï¼Œå¤„ç†æ•°å­¦å…¬å¼ã€åŠ ç²—ç­‰è¯­ä¹‰æ ‡ç­¾ï¼Œè¾“å‡ºæ ‡å‡†åŒ– Markdownã€‚
    *   **`db.py`**: ç»“æ„åŒ–æ•°æ®åº“è®¿é—®å±‚ (DAL)ã€‚è´Ÿè´£ç»´æŠ¤å±€åŸŸå†…çš„ SQLiteï¼ŒåŒ…å« `articles` å»ºè¡¨ã€å…¨æ–‡ç´¢å¼•ã€é˜²é‡æ’å¼‚çš„ UPSERT æ“ä½œï¼Œä»¥åŠåŸºç¡€çš„æ¨¡ç³ŠæŸ¥è¯¢ã€‚
    *   **`monitor.py`**: å¢é‡æŠ“å–æ¨¡å—ã€‚æ‹‰å–æ”¶è—å¤¹æ¯”å¯¹è®°å½•æŒ‡é’ˆï¼Œè¾“å‡ºâ€œå¢é‡ Deltaâ€ï¼Œé¿å…é‡å¤è¯·æ±‚æ‰«ææµ·é‡æ”¶è—å¤¹å¼•èµ·å°ç¦ã€‚
    *   **`cookie_manager.py`**: åŠ¨æ€è´¦å·è°ƒåº¦ã€‚åœ¨é­é‡ HTTP 403 å½“ä¸‹ç«‹å³æ— ç¼è½¬äº¤è‡³å°šæœªå†·å´çš„ç‹¬ç«‹å‡­è¯ã€‚
    *   **`browser_fallback.py`**: é’ˆå¯¹å¼ºä¿æŠ¤ä¸“æ é¡µï¼Œåœ¨é™é»˜æ¨¡å¼ä¸‹å¼¹å‡ºçš„è‡ªåŠ¨åŒ–å®¹å™¨æ‰§è¡Œç¯å¢ƒã€‚
*   **`static/` (é€†å‘èµ„äº§åº“)**: ç»å¯†çš„é€†å‘ç¯å¢ƒã€‚åŒ…å«äº†å‰¥ç¦»å‡ºæ¥çš„å…³é”®ç®—æ³•ï¼ˆå¦‚ `x-zse-96`ï¼‰ã€‚
*   **`data/` (è¾“å‡ºç›®å½•)**: ä¸è¢« Git è¿½è¸ªçš„å†…å®¹äº§ç”Ÿåœ°ï¼ŒåŒ…å« `zhihu.db` ä»¥åŠäº§ç”Ÿçš„æ–‡ç« ç‹¬ç«‹ `.md` å­æ–‡ä»¶å¤¹ã€‚

---

## ğŸ“¦ æç®€å®‰è£…éƒ¨ç½²

æœ¬é¡¹ç›®æ·±åº¦ä¾èµ–è¯¸å¦‚ `PyExecJS` ä¸ `curl_cffi` ç­‰åº•å±‚ C åº“ã€‚è¦æ±‚ **Python 3.10+**ã€‚

### æ ‡å‡†å®‰è£…
```bash
# 1. ç›´æ¥é€šè¿‡å®˜æ–¹ pip æºå®‰è£…æ¨èåŒ… (è‡ªåŠ¨æŒ‚è½½å‘½ä»¤è¡Œ)
pip install zhihu-scraper

# 2. å¦‚æœä½ éœ€è¦å¼€å¯æ™ºèƒ½ä¸“æ é™çº§é˜²æŠ¤å¢™ï¼Œéœ€è¦é¢å¤–è¡¥å……æµè§ˆå™¨å¼•æ“ï¼š
playwright install chromium
```

### å¼€å‘è€…æºç å®‰è£…
```bash
git clone https://github.com/yuchenzhu-research/zhihu-scraper.git
cd zhihu-scraper
pip install -e ".[cli]"
playwright install chromium
```

---

## ğŸ•¹ï¸ äº”å¤§æ ¸å¿ƒæ§åˆ¶å°æŒ‡ä»¤ä¸å·¥ä½œæµ (CLI Workflows)

æ­è½½äº†ä¸€æ•´å¥—å®Œå¤‡çš„ CLI çŸ©é˜µä½“ç³»ï¼ˆå…¼å®¹ç‚«é…·ç»ˆç«¯ UI å’Œ Shell ç®¡é“ç»„åˆï¼‰ï¼Œè¾“å…¥ `zhihu` çš†å¯å¿«é€Ÿè°ƒç”¨ã€‚

### 1. äº¤äº’å¼ä»ªè¡¨ç›˜ç»ˆç«¯ (âœ¨å¼ºçƒˆæ¨è)
å¯åŠ¨ç‚«é…·ä¸”å…¨å›¾å½¢å¼•å¯¼çš„ **Americana Fusion UI ç»ˆç«¯å¼•æ“**ï¼š
```bash
zhihu interactive

# => å›è½¦è¿›å…¥ç»ˆç«¯ï¼Œç”¨ä¸Šä¸‹å·¦å³æŒ‰é”®å’Œç©ºæ ¼ç›´æ¥å›¾å½¢åŒ–é€‰å®šä½ æƒ³æ‰§è¡Œçš„ä»»åŠ¡(Fetch/æ‰¹é‡/æ£€ç´¢ç­‰)ã€‚
```

### 2. ç²¾å‡†å®šç‚¹æŠ“å– (Fetch)
æµç¨‹ï¼šéªŒè¯ URL -> è§¦å‘è¯·æ±‚/é™çº§ -> å›¾ç‰‡å¹¶å‘è½ç›˜ -> Markdown è½¬æ¢ -> å­˜å…¥ SQLite å¹¶ç”Ÿæˆç‹¬ç«‹æ–‡ç« æ–‡ä»¶ã€‚
```bash
zhihu fetch "https://www.zhihu.com/question/12345/answer/98765"

# å‚æ•°å¯é€‰:
# -i, --no-images : å…‰é€Ÿåªä¸‹è½½æ–‡æœ¬ï¼Œå¿½ç•¥å¤§å›¾å›¾ç‰‡å¹¶å‘
```

### 3. å¤šçº¿ç¨‹æ–‡ä»¶é˜Ÿåˆ—æŠ“å– (Batch)
å¦‚æœä½ çš„ `urls.txt` é‡Œé¢å¡äº† 500 æ¡å„ç§æ‚ä¹±çš„çŸ¥ä¹é“¾æ¥ï¼š
```bash
# -c ä»£è¡¨å¯åŠ¨å¤šå°‘æ¡åº•å±‚é«˜å¹¶å‘ä¿¡é“
zhihu batch ./urls.txt -c 8
```

### 4. æ”¶è—å¤¹çŠ¶æ€æŒ‡é’ˆç›‘æ§åŒæ­¥ (Monitor)
ä¸“ä¸ºå¸¸å¹´ç»´æŠ¤æŸä¸ªå‡ åä¸‡æ¡ç›®ç§äººçŸ¥ä¹å¤§æ”¶è—å¤¹çš„ç”¨æˆ·å¼€å‘ã€‚
æµç¨‹ï¼šè°ƒåº¦ `monitor` -> è·å–æœ€è¿‘çš„ API é¡µé¢ -> ä¸æ–‡ä»¶ `.monitor_state.json` çš„é¡¶ç«¯è®°å½•æ¯”å¯¹ -> ç®—å‡ºå¢é‡å¹¶ä¸¢ç»™å¹¶å‘æ±  -> åŒæ­¥æœ€æ–°æŒ‡é’ˆã€‚
```bash
# è¾“å…¥å…¬å¼€æ”¶è—å¤¹çš„çº¯æ•°å­— ID å³å¯
zhihu monitor 78170682
```

### 5. æœ¬åœ° SQLite çŸ¥è¯†åº“ç–¾é€Ÿé—ªæŸ¥ (Query)
æ£€ç´¢å…¨é‡æŠ“å–ç¦»çº¿åº“åŒ¹é…å…³é”®å­—ï¼æµç¨‹ï¼šç›´æ¥è°ƒç”¨ `db.search_articles` æ‰§è¡Œé«˜é€Ÿæ£€ç´¢å¹¶åˆ©ç”¨ Rich æ¡†æ¶æ‰“å°ç»“æœã€‚
```bash
# æ ¹æ®æ ‡é¢˜ã€å†…å®¹æˆ–ä½œè€…ï¼Œä¸€é”®åˆ—å‡ºè¡¨æ ¼ï¼Œæ”¯æŒç®¡é“å†åˆ†å‘
zhihu query "äººå·¥æ™ºèƒ½çš„åº•å±‚é€»è¾‘"
```

---

## ğŸ› ï¸ å½“å‰é™åˆ¶ä¸é«˜çº§ååˆ¶ç­–ç•¥

### âš ï¸ å…³äºä¸“æ çš„æå¼ºé£æ§ (Current Limitations)
çŸ¥ä¹å¯¹å…¶ `zhuanlan.zhihu.com` çš„é˜²æŠ¤ç­–ç•¥è¿œé«˜äºæ­£å¸¸çš„é—®ç­”ï¼ˆé—®ç­”æ¥å£å³ä½¿è¢«å°é”æ¦‚ç‡ä¹Ÿæå°ï¼‰ã€‚æˆ‘ä»¬åœ¨è®¿é—®ä¸“æ çº¯æ–‡æœ¬æ¥å£æ—¶ï¼Œä¾ç„¶æœ‰æé«˜æ¦‚ç‡é­é‡ `403` æˆ–è§¦å‘å®‰å…¨æ£€æµ‹ã€‚**ç³»ç»Ÿä¼šè‡ªåŠ¨å¯åŠ¨æ™ºèƒ½ Playwright å›é€€æœºåˆ¶ï¼Œè¿™æ˜¯æ­£å¸¸ä¸”å¿…è¦çš„æ‰‹æ®µï¼Œé€šè¿‡å¼•å…¥å¾®å°çš„æ€§èƒ½å¼€é”€æ¢å–å…³é”®èµ„æ–™çš„ç»å¯¹ç•™å­˜ç‡ã€‚**

### `cookies.json` ä¸ `cookie_pool/` è½®è¯¢çŸ©é˜µ (é‡ç£…é˜²å°)
å¦‚æœä½ éœ€è¦çˆ¬å–çš„ç§åŸŸå†…å®¹è¦æ±‚æé«˜çš„ç­‰çº§ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å·¥ç¨‹æ ¹ç›®å½•å¡«è£…å¼¹è¯ã€‚
1. é»˜è®¤èº«ä»½ï¼šå°†ä½ ä¸»å·æŠ“åŒ…æ‹¦æˆªåˆ°çš„åŸºç¡€ Cookieï¼ˆJSONæ•°ç»„æ ¼å¼ï¼‰å…¨é‡è¦†ç›–è‡³å·¥å…·ç›®å½•ä¸‹çš„ `cookies.json`ã€‚
2. **é›†ç¾¤é˜²å°**ï¼šåœ¨åŒçº§ç›®å½•ä¸‹æ–°å»ºæ–‡ä»¶å¤¹ `cookie_pool/`ã€‚æŠŠä½ æ‰€æœ‰è´¦å·çš„ `.json` æ”¾è¿›å»ã€‚åœ¨é‡åˆ°é«˜å± WAF æ—¶ï¼ˆæ¯”å¦‚è§¦å‘äº† HTTP 403 æƒ©ç½šï¼‰ï¼Œåº•å±‚çš„ `CookieManager` å°†è‡ªåŠ¨æ— ç¼æ¥åŠ›ã€‚

### `config.yaml` æ ¸å¿ƒèŠ‚å¾‹æŒ‡å¼•
é»˜è®¤æƒ…å†µæ— éœ€ä¿®æ”¹ã€‚å®ƒèƒ½å®šä¹‰æœ€ä½é‡è¯•é—´éš”ä¸å¹¶å‘å®½å®¹åº¦ã€‚
```yaml
zhihu:
  cookies: ./cookies.json

crawler:
  humanize: # æ‹ŸäººåŒ–æ—¶é—´è½´è¡¥å¿
    enabled: true
    min_delay: 1.0   
    max_delay: 3.5   

output:
  directory: data
  format: markdown
```

---

## ğŸ§± æŠ€æœ¯æ ˆåŸºçŸ³ (Tech Stack)

<div align="center">

**[curl_cffi](https://github.com/lexiforest/curl_cffi)** (TLS ä¼ªè£…) Â· **[Playwright](https://playwright.dev/)** (é˜²çº¿é‡æ„) Â· **[SQLite](https://sqlite.org/)** (æ•°æ®å…¨ç³»å›ºåŒ–)

**[Typer](https://typer.tiangolo.com/)** (CLI é©±åŠ¨) Â· **[Rich](https://github.com/Textualize/rich)** (èµ›åš TUI ç»„ä»¶) Â· **[PyExecJS](https://pypi.org/project/PyExecJS/)** (æœ¬åœ° V8 åŠ¨æ€æ‰§è¡Œç¯å¢ƒ)

</div>

---

## âš ï¸ å…è´£å£°æ˜ (Disclaimer)

1. æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶å’Œå­¦ä¹ äº¤æµä½¿ç”¨ï¼Œæ—¨åœ¨æ¢è®¨å¤§è§„æ¨¡éç»“æ„åŒ–æ–‡æ¡£çš„æ•°æ®ä¿å­˜æŠ€æœ¯ã€‚
2. ä»£ç å†…å«æœ‰å¯¹ç‰¹å®šå¹³å°åº•å±‚ HTTP è®¤è¯æŒ‡çº¹ç‰¹å¾çš„è§£æï¼Œä¸¥ç¦ç”¨æ­¤å·¥å…·ä»äº‹ä»»ä½•é»‘äº§æ‰“å‹ã€DDOS æ¶æ„çˆ¬å–åŠå•†ä¸šåŒ–å€’å–æ´»åŠ¨ã€‚
3. ä»»ä½•ç”±ä½¿ç”¨è€…æ“…è‡ªé…ç½®é«˜å¹¶å‘å‚æ•°å¯¼è‡´è¢«çŸ¥ä¹å°é”è´¦æˆ·ï¼Œäº§ç”Ÿçš„è¿å¸¦è´£ä»»ç”±éƒ¨ç½²è€…è‡ªè¡Œå…¨æƒæ‰¿æ‹…ã€‚ä½¿ç”¨è€…åº”éµå®ˆå¯¹åº”å¹³å°çš„æ³•å¾‹æ³•è§„ä¸ç›¸å…³çš„ Robot åè®®ã€‚