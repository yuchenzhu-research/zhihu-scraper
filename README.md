<div align="center">

# ğŸ•·ï¸ Zhihu Scraper

**é«˜ä¿çœŸçŸ¥ä¹å†…å®¹ç¦»çº¿å¤‡ä»½å·¥å…· Â· çº¯åç«¯åŸç”Ÿ API æ¡æ‰‹ Â· SQLite å®ä½“åº“æ¶æ„**

[![Python Version](https://img.shields.io/pypi/pyversions/zhihu-scraper.svg?style=for-the-badge&logo=python)](https://pypi.org/project/zhihu-scraper/)
[![License](https://img.shields.io/github/license/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge)](https://opensource.org/licenses/MIT)
[![Stars](https://img.shields.io/github/stars/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge&logo=github)](https://github.com/yuchenzhu-research/zhihu-scraper/stargazers)
[![Issues](https://img.shields.io/github/issues/yuchenzhu-research/zhihu-scraper.svg?style=for-the-badge)](https://github.com/yuchenzhu-research/zhihu-scraper/issues)

**[æé€ŸæŠ“å–]** Â· **[é˜²å°å· Cookie æ± ]** Â· **[Markdown ä¸æ•°æ®åº“åŒå¼•æ“å­˜å‚¨]**

</div>

---

## âš¡ æ ¸å¿ƒæ¼”è¿› (Core Evolution)

æœ¬é¡¹ç›®é‡æ„ä¸ºç›´æ¥ä¸çŸ¥ä¹åå° JSON API äº¤äº’çš„çº¯ç²¹ç½‘ç»œåè®®å¼•æ“ã€‚é¡¹ç›®ä¸¥æ ¼éµå¾ªé¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD) çš„åˆ†å±‚æ€æƒ³ï¼Œæœç»äº†é¢æ¡ä»£ç ã€‚

| æ ¸å¿ƒç»„ä»¶å¼•æ“ | æŠ€æœ¯è§£æä¸åŠŸèƒ½ç‰¹æ€§ |
| :--- | :--- |
| ğŸš€ **åŸç”Ÿ API æé€Ÿå¼•æ“** | ä¾èµ– `curl_cffi` å®Œç¾æ¨¡æ‹Ÿ Chrome åº•å±‚ TLS/HTTP2 ç½‘ç»œæ¡æ‰‹æŒ‡çº¹ï¼Œæ— è§†ç»å¤§æ•°ç½‘å…³æ‹¦æˆªã€‚åŒæ—¶æœ¬åœ°å†…ç½® `z_core.js` V8 é€†å‘ç­¾åéªŒè¯ï¼Œå®ç° **æ¯«ç§’çº§ã€0æ¸²æŸ“å¼€é”€** çš„æ•°æ®æ•è·ã€‚ |
| ğŸ’¿ **SQLite ä¸»åŠ¨å­˜å‚¨æ± ** | è·å–åˆ°çš„æ¯ä¸€ä¸ªé—®é¢˜/ä¸“æ /å›ç­”ï¼Œæå–å‡ºæ ¸å¿ƒå­—æ®µï¼Œä½¿ç”¨ UPSERT æŒä¹…åŒ–å†™å…¥ `data/zhihu.db` æ„å»ºçœŸæ­£çš„**æœ¬åœ°åŒ–æ™ºèƒ½çŸ¥è¯†åº“**ã€‚ |
| ğŸ”„ **è‡ªåŠ¨åŒ–å¢é‡ç›‘å¬ (Monitor)** | å…¨æ–°æŒ‡ä»¤ `zhihu monitor`ï¼åˆ©ç”¨çŠ¶æ€æŒ‡é’ˆ (Last ID) å®ç°å¯¹ä¸Šä¸‡æ¡çŸ¥ä¹â€œæ”¶è—å¤¹â€è®°å½•çš„**æ— ç¼å¢é‡æ‰«æ**ï¼ŒåªæŠ“å–æœ€æ–°åŠ å…¥çš„æ•°æ®ã€‚æå…¶é€‚åˆæŒ‚è½½ Cron å®šæ—¶ä»»åŠ¡ï¼ |
| ğŸ›¡ï¸ **ä¸“æ å¢™é™çº§ä¸ Cookie æ± ** | å†…ç½®æ™ºèƒ½é‡è¯•æœºåˆ¶ï¼šå½“é¢å¯¹é˜²æŠ“å–æä¸¥è°¨çš„**çŸ¥ä¹ä¸“æ **æ—¶ï¼Œè‡ªåŠ¨æ— æ„Ÿæ‹‰èµ· Playwright å¹¶æ³¨å…¥åŠ¨æ€ **Cookie è½®æ¢æ± **ä¸­çš„å¤‡ç”¨è´¦å·ï¼Œçªç ´ç»ˆæ `zse_ck` é˜²çº¿ï¼ |
| ğŸ“ **æ’ç‰ˆå¼•æ“å¢å¼º** | å®Œå–„å¹¶æ¸…æ´—å›¾ç‰‡é˜²ç›—é“¾é“¾æ¥ï¼Œåœ¨æœ€ç»ˆå¯¼å‡ºçš„çº¯å‡€ `Markdown` å†…å®Œç¾ç¦»çº¿è½¬æ¢å¤æ‚çš„ LaTeX ($...$) çŸ©é˜µå…¬å¼ä¸é‡ç‚¹åŠ ç²—å†…å®¹ã€‚ |

---

## ğŸ—ï¸ æ¶æ„ç²’åº¦æ‹†è§£ (Directory Structure)

å½“å‰çš„æ¶æ„éå¸¸æ¸…æ™°ï¼Œå®ç°äº†æ¨¡å—åŒ–ã€è§£è€¦åˆä¸é«˜å†…èšï¼š

*   **`cli/` (å…¥å£ä¸è§†å›¾å±‚)**
    *   `app.py`: æ ¸å¿ƒ Typer CLI è·¯ç”±ã€‚å®šä¹‰äº† `fetch`, `batch`, `monitor`, `query` ç­‰æ ¸å¿ƒå‘½ä»¤ï¼Œè´Ÿè´£è§£æä¼ å‚å¹¶æ•´åˆ UI è¾“å‡ºã€‚
    *   `interactive.py`: äº¤äº’å¼ä»ªè¡¨ç›˜ç»ˆç«¯ï¼Œå¯¹ä¼ ç»Ÿå‘½ä»¤è¡Œè¾“å…¥çš„æå¼ºå›¾å½¢åŒ–å¢å¼ºã€‚
*   **`core/` (æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚)**
    *   **`api_client.py`**: å¼•æ“ä¹‹æºã€‚è´Ÿè´£å‘çŸ¥ä¹å‘èµ·åº•å±‚è¯·æ±‚ï¼Œåˆå¹¶ Cookieã€è°ƒç”¨ç­¾åç®—æ³•å¹¶æºå¸¦ TLS æŒ‡çº¹ï¼Œè¿”å›çº¯å‡€ JSONã€‚
    *   **`scraper.py`**: é¡µé¢çº§ä¸šåŠ¡ç¼–æ’ã€‚è´Ÿè´£åˆ¤æ–­ URL ç±»å‹ï¼Œå‘ä¸‹æ¸¸ç´¢è¦æ•°æ®ï¼Œæç‚¼æ ¸å¿ƒæ­£æ–‡å¹¶ç»Ÿç­¹å›¾ç‰‡ä¸‹è½½å·¥ä½œã€‚
    *   **`converter.py`**: Markdown è§£æå™¨ã€‚å°†å›¾ç‰‡æºç»Ÿä¸€æ›¿æ¢ä¸ºæœ¬åœ°ç›¸å¯¹è·¯å¾„ï¼Œå¤„ç† LaTeX åŠåŠ ç²—ç­‰è¯­ä¹‰æ ‡ç­¾ï¼Œæ¸²æŸ“æ ‡å‡† Markdown æ’ç‰ˆã€‚
    *   **`db.py`**: ç»“æ„åŒ–æ•°æ®åº“è®¿é—®å±‚ (DAL)ã€‚è´Ÿè´£ç»´æŠ¤å±€åŸŸ SQLite åº“ï¼Œå»ºç«‹å…¨æ–‡ç´¢å¼•å¹¶æä¾›é˜²é‡å†²çªæŒä¹…åŒ–å¤„ç†æœºåˆ¶ã€‚
    *   **`monitor.py`**: å¢é‡æŠ“å–æ¨¡å—ã€‚æ¯”å¯¹æ”¶è—å¤¹æœ€æ–°è®°å½•æŒ‡é’ˆï¼Œæ¨ç®—ç³»ç»Ÿå¢é‡ï¼Œé˜²æ­¢è§¦å‘é‡å¤æµè§ˆé™åˆ¶ã€‚
    *   **`cookie_manager.py`**: åŠ¨æ€è´¦å·è°ƒåº¦ã€‚åœ¨é­é‡ API é¢‘ç‡ç®¡åˆ¶æˆ–æ‹¦æˆªæ—¶ï¼Œæ— ç¼åˆ†é…æœªå†·å†»çš„ç‹¬ç«‹å‡­è¯è½¬äº¤ä¸Šä¸‹æ–‡ã€‚
    *   **`browser_fallback.py`**: é’ˆå¯¹å¼ºä¿æŠ¤ä¸“æ é¡µï¼Œåœ¨é™é»˜æ¨¡å¼ä¸‹å¼¹å‡ºçš„è‡ªåŠ¨åŒ–å®¹å™¨æ‰§è¡Œç¯å¢ƒã€‚
*   **`static/` (é€†å‘èµ„äº§åº“)**: ç»å¯†çš„é€†å‘ç¯å¢ƒã€‚åŒ…å«äº†å‰¥ç¦»å‡ºæ¥çš„å…³é”®ç®—æ³•ï¼ˆå¦‚ `x-zse-96`ï¼‰ã€‚
*   **`data/` (è¾“å‡ºç›®å½•)**: ä¸è¢« Git è¿½è¸ªçš„å†…å®¹äº§ç”Ÿåœ°ï¼ŒåŒ…å« `zhihu.db` ä»¥åŠäº§ç”Ÿçš„æ–‡ç« ç‹¬ç«‹ `.md` å­æ–‡ä»¶å¤¹ã€‚

---

## ğŸ“¦ æç®€å®‰è£…éƒ¨ç½²

æœ¬é¡¹ç›®æ·±åº¦ä¾èµ–è¯¸å¦‚ `PyExecJS` ä¸ `curl_cffi` ç­‰åº•å±‚ C åº“ã€‚è¦æ±‚ **Python 3.10+**ã€‚

### æ ‡å‡†å®‰è£…
```bash
# 1. åŸºç¡€ç¯å¢ƒå®‰è£…
pip install zhihu-scraper

# 2. å¦‚æœéœ€å¼€å¯ä¸“æ é˜²æŠ¤é™çº§ç¯å¢ƒï¼Œé¡»æŒ‰éœ€è¡¥å……æ¸²æŸ“å¼•æ“ï¼š
playwright install chromium
```

### å¼€å‘è€…æºç å®‰è£…
```bash
git clone https://github.com/yuchenzhu-research/zhihu-scraper.git
cd zhihu-scraper
pip install -e ".[cli]"
playwright install chromium
```

---

## ğŸ•¹ï¸ äº”å¤§æ ¸å¿ƒæ§åˆ¶å°æŒ‡ä»¤ (CLI Workflows)

æ­è½½äº†å®Œå¤‡çš„ CLI æ§åˆ¶å°åº”ç”¨ç³»ç»Ÿï¼Œè¾“å…¥ `zhihu` å³å¯å…¨å±€è°ƒç”¨ã€‚

### 1. äº¤äº’å¼ä»ªè¡¨ç›˜ç»ˆç«¯ (âœ¨å¼ºçƒˆæ¨è)
å¯åŠ¨å…¨å›¾å½¢æ§åˆ¶å°å¼•å¯¼çš„ç»ˆç«¯ UI ç¯å¢ƒï¼š
```bash
zhihu interactive

# => å›è½¦è¿›å…¥ç»ˆç«¯åï¼Œç›´æ¥å›¾å½¢åŒ–å‹¾é€‰åŠé…ç½®æ‰¹é‡æŠ“å–ã€æ£€ç´¢ä»»åŠ¡
```

### 2. ç²¾å‡†æŠ“å– (Fetch)
æµç¨‹ï¼šéªŒè¯ URL -> è§¦å‘è¯·æ±‚ä¸é™çº§ -> èµ„æºå¹¶å‘è½ç›˜ -> æ ¼å¼è½¬æ¢ä¸ SQLite æŒä¹…åŒ–ã€‚
```bash
zhihu fetch "https://www.zhihu.com/question/12345/answer/98765"

# å‚æ•°å¯é€‰:
# -i, --no-images : çº¯æ–‡æœ¬æ¨¡å¼ï¼Œå¿½ç•¥å›¾ç‰‡å¹¶å‘æ“ä½œ
```

### 3. å¤šçº¿ç¨‹æ–‡ä»¶é˜Ÿåˆ—æŠ“å– (Batch)
é€šè¿‡å¤–éƒ¨æ–‡æœ¬æºæä¾›åˆ—è¡¨ï¼Œæ‰§è¡Œä¸é—´æ–­å…¨è‡ªåŠ¨æ”¶é›†ï¼š
```bash
# -c ä»£è¡¨å¯åŠ¨å¯¹åº”çš„åº•å±‚é«˜å¹¶å‘ä¿¡é“
zhihu batch ./urls.txt -c 8
```

### 4. æ”¶è—å¤¹è‡ªåŠ¨åŒ–çŠ¶æ€ç›‘æ§ (Monitor)
ä¸“ä¸ºæŒä¹…ç»´æŠ¤é•¿ç”Ÿå‘½å‘¨æœŸé‡åº¦çŸ¥ä¹æ”¶è—è®°å½•çš„ç”¨æˆ·è®¾è®¡ã€‚
æµç¨‹ï¼šè°ƒåº¦ `monitor` -> è§£ææœ€è¿‘ API é¡µé¢åŒºå— -> å¯¹æ¯”æœ¬åœ° `.monitor_state.json` çš„é¡¶ç«¯è®°å½• -> è®¡ç®—ç»å¯¹å¢é‡å¹¶äº¤æ¥ç»™å¹¶å‘æ±  -> åŒæ­¥æ›´æ–°æŒ‡é’ˆçŠ¶æ€ã€‚
```bash
# ä¼ å…¥ç›®æ ‡æ”¶è—å•çš„æ•°å­— ID (ä¾‹å¦‚ https://www.zhihu.com/collection/78170682)
zhihu monitor 78170682
```

### 5. ç§åŸŸæœ¬åœ°æ•°æ®åº“é—ªæŸ¥ (Query)
æ”¯æŒå¤šç»´æ•°æ®åº“æŸ¥è¯¢ï¼Œè·¨è¿‡å…¨éƒ¨ç¦»çº¿çŸ¥è¯†åº“å…¨é€Ÿå“åº”ã€‚
```bash
# æ ¹æ®ä»»æ„æ ‡é¢˜ã€æ®µè½æˆ–ä½œè€…åç§°æ·±åº¦éå†æ£€ç´¢
zhihu query "äººå·¥æ™ºèƒ½çš„åº•å±‚é€»è¾‘"
```

---

## ğŸ› ï¸ é«˜çº§ååˆ¶ç­–ç•¥

### âš ï¸ ä¸“æ é«˜å±å®‰å…¨é™åˆ¶ (Current Limitations)
çŸ¥ä¹ä¸“æ  `zhuanlan.zhihu.com` çš„åº”ç”¨å‹é˜²æŠ¤ç­–ç•¥è¿œé«˜äºå¸¸è§„æ¨¡å—ã€‚å½“å‘èµ·æ¥å£è¯·æ±‚æ—¶ï¼Œæå¤§æ¦‚ç‡ä¼šè§¦ç¢° `403` ç®¡åˆ¶æˆ–éªŒè¯å¢™æ‹¦æˆªã€‚**æ¡†æ¶å†…åµŒè‡ªåŠ¨åŒ–çš„ Playwright é™çº§å›é€€æœºåˆ¶ï¼Œé€šè¿‡å®¹è®¸å°‘è®¸æ— å¤´æ¸²æŸ“æ€§èƒ½å¼€é”€æœ€å¤§åŒ–æ–‡æœ¬å›æ”¶å®Œæ•´åº¦ã€‚**

### é…ç½®å¤šè´¦å·éªŒè¯çŸ©é˜µ (Cookies Rotation)
å¦‚éœ€å¼€å¯æè‡´æ”¶é›†èƒ½åŠ›ï¼Œè¯·åœ¨æ­¤ç³»ç»Ÿé…ç½®å¹¶ç»‘å®šç‹¬ç«‹èº«ä»½ã€‚
1. **é»˜è®¤èº«ä»½**ï¼šå°†æ•è·çš„åŸºç¡€ Cookie ç»“æ„å¯¼å…¥åˆ°é…ç½®ç›®å½•çš„ `cookies.json`ã€‚
2. **é›†ç¾¤é˜²å°**ï¼šåœ¨åŒçº§ç›®å½•ä¸‹å»ºç«‹ `cookie_pool/` æ–‡ä»¶å¤¹æ”¾ç½®å¤šä¸ªå¤‡ä»½å‡­è¯ `.json`ã€‚è‹¥è§¦å‘æé«˜å± WAF æ§åˆ¶æµéš”ç¦»ï¼Œåº•éƒ¨çš„ `CookieManager` å®‰å…¨è·¯ç”±ç½‘ä¼šè‡ªåŠ¨ä¸¢å¼ƒæŠ¥åºŸå‡­è¯ï¼Œåˆ‡æ¢å…¶ä»–æ´»è·ƒèº«ä»½æ¥åŠ›ä»»åŠ¡ã€‚

### `config.yaml` æ ¸å¿ƒèŠ‚å¾‹
ç”¨æ¥è°ƒæ•´æ—¶é—´å¹³æ»‘å’Œå®½å®¹è§„åˆ™ï¼š
```yaml
zhihu:
  cookies: ./cookies.json

crawler:
  humanize: # æ‹ŸäººåŒ–æ—¶é—´è½´è¡¥å¿
    enabled: true
    min_delay: 1.0   
    max_delay: 3.5   

output:
  directory: data
  format: markdown
```

---

## ğŸ§± æŠ€æœ¯æ ˆåŸºçŸ³ (Tech Stack)

<div align="center">

**[curl_cffi](https://github.com/lexiforest/curl_cffi)** (TLS ä¼ªè£…) Â· **[Playwright](https://playwright.dev/)** (é˜²çº¿é‡æ„) Â· **[SQLite](https://sqlite.org/)** (æ•°æ®å…¨ç³»å›ºåŒ–)

**[Typer](https://typer.tiangolo.com/)** (CLI é©±åŠ¨) Â· **[Rich](https://github.com/Textualize/rich)** (èµ›åš TUI ç»„ä»¶) Â· **[PyExecJS](https://pypi.org/project/PyExecJS/)** (æœ¬åœ° V8 åŠ¨æ€æ‰§è¡Œç¯å¢ƒ)

</div>

---

## âš ï¸ å…è´£å£°æ˜ (Disclaimer)

1. æœ¬é¡¹ç›®ä»…ä¾›å­¦æœ¯ç ”ç©¶å’Œå­¦ä¹ äº¤æµä½¿ç”¨ï¼Œæ—¨åœ¨æ¢è®¨å¤§è§„æ¨¡éç»“æ„åŒ–æ–‡æ¡£çš„æ•°æ®ä¿å­˜æŠ€æœ¯ã€‚
2. ä»£ç å†…å«æœ‰å¯¹ç‰¹å®šå¹³å°åº•å±‚ HTTP è®¤è¯æŒ‡çº¹ç‰¹å¾çš„è§£æï¼Œä¸¥ç¦ç”¨æ­¤å·¥å…·ä»äº‹ä»»ä½•é»‘äº§æ‰“å‹ã€DDOS æ¶æ„çˆ¬å–åŠå•†ä¸šåŒ–å€’å–æ´»åŠ¨ã€‚
3. ä»»ä½•ç”±ä½¿ç”¨è€…æ“…è‡ªé…ç½®é«˜å¹¶å‘å‚æ•°å¯¼è‡´è¢«çŸ¥ä¹å°é”è´¦æˆ·ï¼Œäº§ç”Ÿçš„è¿å¸¦è´£ä»»ç”±éƒ¨ç½²è€…è‡ªè¡Œå…¨æƒæ‰¿æ‹…ã€‚ä½¿ç”¨è€…åº”éµå®ˆå¯¹åº”å¹³å°çš„æ³•å¾‹æ³•è§„ä¸ç›¸å…³çš„ Robot åè®®ã€‚